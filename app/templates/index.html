<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Submission Pre-check ‚Äî Research Paper Validation</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>üñ•Ô∏è</text></svg>">
    <style>
        :root {
            --primary: #5db6ff;
            --primary-dark: #2b8ae0;
            --secondary: #9fb2d2;
            --light: #111b2f;
            --dark: #dbe9ff;
            --border: #253b61;
            --border-strong: #365481;
            --shadow: 0 18px 40px -24px rgba(0, 0, 0, 0.9);
            --radius: 12px;
            --drop-zone-highlight: rgba(93, 182, 255, 0.16);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes rise-in {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes border-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(93, 182, 255, 0.22);
            }
            100% {
                box-shadow: 0 0 0 14px rgba(93, 182, 255, 0);
            }
        }

        @keyframes line-scan {
            from {
                transform: translateX(-120%);
            }
            to {
                transform: translateX(120%);
            }
        }

        @keyframes tab-rise {
            from {
                opacity: 0;
                transform: translateY(8px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(93, 182, 255, 0);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(93, 182, 255, 0.12);
            }
        }

        @keyframes btn-sweep {
            from {
                transform: translateX(-120%);
            }
            to {
                transform: translateX(130%);
            }
        }

        body {
            font-family: 'IBM Plex Sans', 'Source Sans Pro', 'Noto Sans', sans-serif;
            max-width: 980px;
            margin: 0 auto;
            padding: 2rem;
            background:
                radial-gradient(1200px 600px at 10% -10%, rgba(93, 182, 255, 0.18), transparent 50%),
                radial-gradient(800px 500px at 90% 0%, rgba(34, 197, 94, 0.08), transparent 45%),
                linear-gradient(160deg, #040916 0%, #050b17 55%, #081125 100%);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            background: linear-gradient(180deg, rgba(15, 26, 47, 0.95) 0%, rgba(11, 21, 39, 0.95) 100%);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(4px);
            padding: 2.5rem;
            margin-bottom: 2rem;
            animation: rise-in 0.45s ease both;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            position: relative;
            background: radial-gradient(600px 120px at 50% 0%, rgba(93, 182, 255, 0.18), transparent 70%);
        }

        header::after {
            content: '';
            position: absolute;
            left: 25%;
            right: 25%;
            bottom: -1px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0.8;
        }

        h1 {
            color: #d9ebff;
            font-size: 2.1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        h2 {
            font-size: 1rem;
            color: var(--secondary);
            font-weight: 400;
            opacity: 0.85;
        }

        .upload-section {
            margin-bottom: 2rem;
        }

        .file-input-wrapper {
            position: relative;
            display: block;
            margin-bottom: 1rem;
            border: 1px dashed var(--border-strong);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            transition: border-color 0.25s ease, background-color 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease;
            cursor: pointer;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(21, 35, 63, 0.78), rgba(15, 27, 48, 0.88));
        }

        .file-input-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 52%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(114, 198, 255, 0.28) 50%, transparent 100%);
            pointer-events: none;
            opacity: 0.7;
        }

        .file-input-wrapper:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 18px 26px -26px rgba(93, 182, 255, 0.85);
        }

        .file-input-wrapper:hover::after,
        .file-input-wrapper.drag-active::after {
            animation: line-scan 1.1s ease-in-out;
        }

        .file-input-wrapper.drag-active {
            border-color: var(--primary);
            box-shadow: 0 0 0 1px rgba(93, 182, 255, 0.32), 0 0 0 8px rgba(93, 182, 255, 0.05);
            animation: border-glow 0.8s ease-out;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            color: var(--secondary);
        }

        .file-input-wrapper.drag-active #dropHint {
            color: #e0f2ff;
            font-weight: 600;
        }

        .file-input-label .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
            text-shadow: 0 0 14px rgba(93, 182, 255, 0.45);
        }

        .text-sm {
            font-size: 0.88rem;
            color: #8ea2c8;
        }

        .file-info {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: var(--radius);
            display: none;
            align-items: center;
            gap: 0.6rem;
            border: 1px solid var(--border);
            background: rgba(22, 39, 67, 0.65);
            color: #c6dbff;
        }

        .file-info.show {
            display: flex;
            animation: rise-in 0.25s ease both;
        }

        .file-info.success {
            border-color: rgba(34, 197, 94, 0.5);
            background: rgba(34, 197, 94, 0.09);
        }

        .file-badge {
            display: inline-flex;
            min-width: 42px;
            justify-content: center;
            align-items: center;
            padding: 0.2rem 0.45rem;
            border-radius: 999px;
            border: 1px solid var(--border-strong);
            font-size: 0.72rem;
            letter-spacing: 0.04em;
            font-weight: 700;
            color: #d7e9ff;
            background: rgba(15, 27, 48, 0.9);
            text-transform: uppercase;
        }

        .file-badge.pdf {
            border-color: rgba(34, 197, 94, 0.45);
            color: #a8efc5;
        }

        .file-badge.zip {
            border-color: rgba(93, 182, 255, 0.5);
            color: #c7e7ff;
        }

        .layout-config {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--dark);
        }

        .layout-options {
            margin-top: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem 2rem;
        }

        .layout-option {
            margin-right: 0;
            color: var(--secondary);
        }

        .layout-option input[type="radio"] {
            accent-color: var(--primary);
            margin-right: 0.3rem;
            transform: translateY(1px);
        }

        .btn {
            display: inline-block;
            width: 100%;
            padding: 0.85rem 1.2rem;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: #021427;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.02em;
            cursor: pointer;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
            box-shadow: 0 16px 26px -20px rgba(77, 163, 255, 0.95);
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -130%;
            width: 55%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.35) 50%, transparent 100%);
            transform: translateX(-120%);
            pointer-events: none;
            z-index: 1;
        }

        .btn::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            box-shadow: 0 0 0 0 rgba(93, 182, 255, 0.35);
            animation: pulse 2.4s infinite;
            pointer-events: none;
            z-index: 0;
        }

        .btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.03);
            box-shadow: 0 18px 28px -18px rgba(77, 163, 255, 1);
        }

        .btn:hover::before {
            animation: btn-sweep 0.9s ease;
        }

        .btn:disabled {
            background: #365277;
            color: #d1dbec;
            cursor: not-allowed;
            opacity: 0.75;
            box-shadow: none;
            transform: none;
        }

        .btn:disabled::after {
            animation: none;
            box-shadow: none;
        }

        .features {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(150deg, rgba(20, 35, 63, 0.78), rgba(14, 25, 47, 0.95));
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .features h3 {
            font-size: 1.08rem;
            margin-bottom: 1rem;
            color: #c5ddff;
        }

        .features ul.checklist {
            list-style: none;
            padding-left: 0;
            columns: 2;
            gap: 0.9rem;
        }

        .features ul.checklist li {
            margin-bottom: 0.6rem;
            break-inside: avoid;
        }

        .features ul.checklist label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a6bddf;
            cursor: pointer;
            padding: 0.45rem 0.55rem;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }

        .features ul.checklist label:hover {
            border-color: var(--border);
            background: rgba(29, 48, 82, 0.5);
            transform: translateY(-1px);
        }

        .features ul.checklist input[type="checkbox"] {
            transform: translateY(1px);
            accent-color: var(--primary);
        }

        .features ul.checklist input[type="checkbox"]:checked + span {
            color: #e6f2ff;
            font-weight: 600;
        }

        .result-section {
            margin-top: 2rem;
        }

        .result-section h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #cde3ff;
        }

        .notice {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.42);
            border-radius: var(--radius);
            padding: 0.8rem;
            margin-bottom: 1rem;
            color: #f9cb66;
        }

        .result-container {
            position: relative;
        }

        .result-tabs {
            display: none;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tab-btn {
            padding: 0.5rem 0.9rem;
            border: 1px solid var(--border);
            background: rgba(19, 33, 58, 0.92);
            color: #c8dcff;
            border-radius: 999px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            animation: tab-rise 0.35s ease both;
        }

        .tab-btn:nth-child(2) { animation-delay: 0.03s; }
        .tab-btn:nth-child(3) { animation-delay: 0.06s; }
        .tab-btn:nth-child(4) { animation-delay: 0.09s; }
        .tab-btn:nth-child(5) { animation-delay: 0.12s; }
        .tab-btn:nth-child(6) { animation-delay: 0.15s; }
        .tab-btn:nth-child(7) { animation-delay: 0.18s; }
        .tab-btn:nth-child(8) { animation-delay: 0.21s; }

        .tab-btn:hover {
            border-color: var(--primary);
            color: #e5f3ff;
            transform: translateY(-1px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: #041427;
            border-color: transparent;
            font-weight: 600;
        }

        .tab-btn.status-true {
            background: rgba(34, 197, 94, 0.14);
            border-color: rgba(34, 197, 94, 0.36);
            color: #99ebb4;
        }

        .tab-btn.status-true::before {
            content: '‚úî';
            margin-right: 0.3rem;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .tab-btn.status-true.active {
            background: linear-gradient(135deg, #1f9a4d, #27c565);
            border-color: transparent;
            color: #031208;
        }

        .tab-btn.status-false {
            background: rgba(248, 113, 113, 0.12);
            border-color: rgba(248, 113, 113, 0.33);
            color: #ffb4b4;
        }

        .tab-btn.status-false::before {
            content: '‚úñ';
            margin-right: 0.3rem;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .tab-btn.status-false.active {
            background: linear-gradient(135deg, #d94f4f, #f87171);
            border-color: transparent;
            color: #190707;
        }

        .confidence-badge {
            display: inline-block;
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .confidence-item {
            padding: 0.45rem 0.65rem;
            margin-bottom: 0.45rem;
            border-left: 3px solid transparent;
            background: rgba(18, 31, 55, 0.86);
            border-radius: 6px;
            color: #c9ddff;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .confidence-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -14px rgba(0, 0, 0, 0.8);
        }

        .confidence-item-high {
            border-left-color: #f87171;
            background: rgba(248, 113, 113, 0.1);
        }

        .confidence-item-medium {
            border-left-color: #fb923c;
            background: rgba(251, 146, 60, 0.1);
        }

        .confidence-item-low {
            border-left-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .confidence-details {
            margin-top: 0.3rem;
            white-space: pre-wrap;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .confidence-high {
            background: rgba(248, 113, 113, 0.16);
            color: #ffb4b4;
            border: 1px solid rgba(248, 113, 113, 0.45);
        }

        .confidence-medium {
            background: rgba(251, 146, 60, 0.16);
            color: #ffd0a0;
            border: 1px solid rgba(251, 146, 60, 0.45);
        }

        .confidence-low {
            background: rgba(251, 191, 36, 0.16);
            color: #ffe59d;
            border: 1px solid rgba(251, 191, 36, 0.45);
        }

        .confidence-unknown {
            background: rgba(148, 163, 184, 0.16);
            color: #cad5e6;
            border: 1px solid rgba(148, 163, 184, 0.45);
        }

        .confidence-item-unknown {
            border-left-color: #94a3b8;
            background: rgba(148, 163, 184, 0.08);
        }

        .result-empty {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            background-color: var(--light);
            min-height: 150px;
            white-space: pre-wrap;
            color: #c8dbff;
        }

        .section-panel {
            display: none;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            background: linear-gradient(170deg, rgba(17, 29, 52, 0.94), rgba(12, 22, 41, 0.98));
        }

        .section-panel::before {
            content: '';
            display: block;
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, var(--primary), transparent);
            margin-bottom: 0.6rem;
            border-radius: 999px;
        }

        .section-panel.active {
            display: block;
            animation: rise-in 0.25s ease both;
        }

        .section-title {
            font-weight: 600;
            color: #cde4ff;
            margin-bottom: 0.5rem;
        }

        pre {
            white-space: pre-wrap;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 0.5rem;
            background-color: var(--light);
            color: #c6dbff;
            min-height: 150px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', 'Cascadia Mono', Consolas, monospace;
            font-size: 0.9rem;
        }

        .section-panel pre {
            border: none;
            padding: 0;
            margin: 0;
            background: transparent;
        }

        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #d4e8ff;
            font-weight: 600;
            padding: 0.7rem 1rem;
            border-radius: 999px;
            border: 1px solid rgba(93, 182, 255, 0.45);
            background: rgba(12, 23, 40, 0.95);
            box-shadow: 0 0 0 1px rgba(93, 182, 255, 0.18), 0 14px 26px -22px rgba(93, 182, 255, 0.8);
        }

        .loading.show {
            display: block;
        }

        .log-title {
            margin-top: 2rem;
        }

        .log-output {
            background-color: #0a1425;
            color: #acc9f2;
            font-size: 0.85rem;
            min-height: 150px;
            border-color: #20385e;
            font-family: 'JetBrains Mono', 'Cascadia Mono', Consolas, monospace;
            line-height: 1.5;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .log-line {
            display: block;
            margin-bottom: 0.25rem;
        }

        .log-info {
            color: #9dd0ff;
        }

        .log-error {
            color: #ff9a9a;
        }

        .log-success {
            color: #8cf5b6;
        }

        .resource-section {
            margin-top: 2rem;
        }

        .resource-title {
            color: #cbe4ff;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .resource-links {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 0.5rem 0;
        }

        .resource-link {
            color: #9dd0ff;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            transition: transform 0.2s ease, border-color 0.2s ease, color 0.2s ease, background-color 0.2s ease;
            background: rgba(17, 30, 54, 0.8);
        }

        .resource-link:hover {
            transform: translateY(-1px);
            border-color: var(--primary);
            color: #d8eeff;
            background: rgba(31, 53, 92, 0.82);
        }

        .footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--secondary);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .container {
                padding: 1.5rem;
            }

            .features ul.checklist {
                columns: 1;
            }

            .resource-links {
                gap: 0.7rem;
            }

            .resource-link {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Submission Pre-check System</h1>
            <h2><b>Double-Blind</b> Validation for AI Research Submissions</h2>
        </header>
 
        <section class="features">
            <h3>‚úÖ Detection Capabilities</h3>
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="image_quality" />
                        <span>Image clarity verification</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="cross_ref" />
                        <span>Image/table citation validation (LaTeX Only)</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="pdf_metadata" />
                        <span>PDF Metadata (PDF Only)</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="link_anonymization" />
                        <span>Link anonymization check</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="anonymity" />
                        <span>Author anonymity check (LLM)</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="hidden_prompt" />
                        <span>Hidden prompt identification (LLM)</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="news" disabled />
                        <span>To be added...</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" name="checks" value="summary" />
                        <span>Check Summary (LLM)</span>
                    </label>
                </li>
            </ul>
        </section>

        <section class="upload-section">
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="file-input-wrapper" id="fileWrapper">
                    <input 
                        type="file" 
                        name="file" 
                        required 
                        accept=".pdf,.zip"
                        id="fileInput"
                    />
                    <label class="file-input-label" for="fileInput">
                        <div class="icon">üìÅ</div>
                        <p id="dropHint">Click to select file or drag & drop</p>
                        <p class="text-sm">Supported formats: PDF, LaTeX ZIP</p>
                        <p class="text-sm">(LaTeX ZIP Recommended)</p>
                    </label>
                </div>

                <div class="file-info" id="fileInfo">
                    <span class="file-badge" id="fileTypeBadge">FILE</span>
                    <p><strong>Selected file:</strong> <span id="fileName">None</span></p>
                </div>

                <div class="layout-config">
                    <label><strong>Layout (PDF Only):</strong></label>
                    <div class="layout-options">
                        <label class="layout-option">
                            <input type="radio" name="layout" value="single" checked /> Single Column
                        </label>
                        <label class="layout-option">
                            <input type="radio" name="layout" value="dual" /> Dual Column
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn" id="uploadBtn">
                    Start Pre-check Analysis
                </button>
            </form>
        </section>

        <section class="result-section">
            <div class="notice">
                ‚ö†Ô∏è <strong>Important Notice:</strong> The analysis results are for reference only and cannot guarantee 100% accuracy.
            </div>
            <h3>üìä Analysis Results</h3>
            <div class="result-container">
                <div class="loading" id="loading">Analyzing your submission... Please wait</div>
                <div class="result-tabs" id="resultTabs">
                    <button class="tab-btn" data-section="file_info">File Info</button>
                    <button class="tab-btn" data-section="image_info">Image Info</button>
                    <button class="tab-btn" data-section="link_info">Link Info</button>
                    <button class="tab-btn" data-section="cross_ref_info">Cross Ref</button>
                    <button class="tab-btn" data-section="pdf_metadata">PDF Metadata</button>
                    <button class="tab-btn" data-section="anonymity_check">Anonymity</button>
                    <button class="tab-btn" data-section="hidden_prompt_check">Hidden Prompt</button>
                    <button class="tab-btn" data-section="summary_info">Summary</button>
                </div>
                <div id="resultEmpty" class="result-empty">Upload a file and click "Start Pre-check Analysis" to see results.</div>

                <div id="section-file_info" class="section-panel">
                    <div class="section-title">File Info</div>
                    <pre id="section-file_info-pre"></pre>
                </div>
                <div id="section-image_info" class="section-panel">
                    <div class="section-title">Fig Info</div>
                    <pre id="section-image_info-pre"></pre>
                </div>
                <div id="section-link_info" class="section-panel">
                    <div class="section-title">Link Detection</div>
                    <pre id="section-link_info-pre"></pre>
                </div>
                <div id="section-cross_ref_info" class="section-panel">
                    <div class="section-title">Cross-ref Info</div>
                    <pre id="section-cross_ref_info-pre"></pre>
                </div>
                <div id="section-pdf_metadata" class="section-panel">
                    <div class="section-title">PDF Metadata</div>
                    <pre id="section-pdf_metadata-pre"></pre>
                </div>
                <div id="section-anonymity_check" class="section-panel">
                    <div class="section-title">Anonymity detection</div>
                    <pre id="section-anonymity_check-pre"></pre>
                </div>
                <div id="section-hidden_prompt_check" class="section-panel">
                    <div class="section-title">Prompt Injection</div>
                    <pre id="section-hidden_prompt_check-pre"></pre>
                </div>
                <div id="section-summary_info" class="section-panel">
                    <div class="section-title">LLM Summary</div>
                    <pre id="section-summary_info-pre"></pre>
                </div>
            </div>

            <h3 class="log-title">üìù Processing Log</h3>
            <div class="result-container">
                <pre id="log" class="log-output"><span class="log-line log-info">Ready to process files...</span></pre>
            </div>
        </section>
    </div>

    <section class="container resource-section">
        <h3 class="resource-title">ü§ù Related Resources</h3>
        <div class="resource-links">
            <a href="https://labourden.github.io/tpye3view/" class="resource-link">
                tpye3view - PDF Type3 Font Inspector
            </a>
            <a href="https://www.pdf2cmyk.com/" class="resource-link">
                pdf2cmyk - PDF Color Space Converter
            </a>
            <a href="https://github.com/thinkwee/BibGuard" class="resource-link">
                BibGuard - Bibliography & LaTeX Quality Auditor
            </a>
            <a href="https://www.zerogpt.com/" class="resource-link">
                ZeroGPT - AI Content Detection Tool
            </a>
        </div>
    </section>

    <footer class="footer">
        <p>AI Submission Pre-check System | For Academic Research Use Only</p>
    </footer>

    <script>
        // DOM Elements
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const resultEmpty = document.getElementById('resultEmpty');
        const resultTabs = document.getElementById('resultTabs');
        const loading = document.getElementById('loading');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileWrapper = document.getElementById('fileWrapper');
        const dropHint = document.getElementById('dropHint');
        const log = document.getElementById('log');
        const fileTypeBadge = document.getElementById('fileTypeBadge');
        const tabButtons = Array.from(document.querySelectorAll('.tab-btn'));
        const sectionPanels = {
            file_info: document.getElementById('section-file_info'),
            image_info: document.getElementById('section-image_info'),
            link_info: document.getElementById('section-link_info'),
            cross_ref_info: document.getElementById('section-cross_ref_info'),
            pdf_metadata: document.getElementById('section-pdf_metadata'),
            anonymity_check: document.getElementById('section-anonymity_check'),
            hidden_prompt_check: document.getElementById('section-hidden_prompt_check'),
            summary_info: document.getElementById('section-summary_info'),
        };

        // Store parse results for check
        let lastParseResult = null;
        let lastUploadedFileName = null;
        const DROP_HINT_DEFAULT = 'Click to select file or drag & drop';
        const DROP_HINT_RELEASE = 'Release to upload file';
        const DROP_HINT_READY = 'File selected. Click "Start Pre-check Analysis".';

        // Log function
        function addLog(message, level = null) {
            const timestamp = new Date().toLocaleTimeString();
            const resolvedLevel = level || (
                /^error/i.test(message)
                    ? 'error'
                    : /(success|finished|completed)/i.test(message)
                        ? 'success'
                        : 'info'
            );
            const line = document.createElement('span');
            line.classList.add('log-line', `log-${resolvedLevel}`);
            line.textContent = `[${timestamp}] [${resolvedLevel.toUpperCase()}] ${message}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
        }

        function resetFileInfoState() {
            fileInfo.classList.remove('show', 'success');
            fileName.textContent = 'None';
            fileTypeBadge.classList.remove('pdf', 'zip');
            fileTypeBadge.textContent = 'FILE';
            if (dropHint) dropHint.textContent = DROP_HINT_DEFAULT;
        }

        function updateFileInfoState(file) {
            if (!file) {
                resetFileInfoState();
                return;
            }
            const ext = file.name.toLowerCase().split('.').pop();
            fileName.textContent = file.name;
            fileInfo.classList.add('show', 'success');
            fileTypeBadge.classList.remove('pdf', 'zip');
            if (ext === 'pdf') {
                fileTypeBadge.classList.add('pdf');
                fileTypeBadge.textContent = 'PDF';
            } else if (ext === 'zip') {
                fileTypeBadge.classList.add('zip');
                fileTypeBadge.textContent = 'ZIP';
            } else {
                fileTypeBadge.textContent = ext ? ext.toUpperCase() : 'FILE';
            }
            if (dropHint) dropHint.textContent = DROP_HINT_READY;
        }

        function hideAllSections() {
            Object.values(sectionPanels).forEach(panel => {
                panel.classList.remove('active');
            });
            tabButtons.forEach(btn => btn.classList.remove('active'));
        }

        function showSection(sectionKey) {
            hideAllSections();
            const panel = sectionPanels[sectionKey];
            const btn = tabButtons.find(b => b.dataset.section === sectionKey);
            if (panel) panel.classList.add('active');
            if (btn) btn.classList.add('active');
        }

        function renderSectionData(sectionKey, data) {
            const pre = document.getElementById(`section-${sectionKey}-pre`);
            if (!pre) return;
            const results = data && Object.prototype.hasOwnProperty.call(data, 'results')
                ? data.results
                : null;
            const specialKeys = ['file_info', 'link_info', 'image_info', 'cross_ref_info', 'pdf_metadata', 'anonymity_check', 'hidden_prompt_check'];

            const decodeText = (input) => {
                if (typeof input !== 'string') return input;
                let text = input;
                const trimmed = text.trim();
                if (
                    (trimmed.startsWith('"') && trimmed.endsWith('"')) ||
                    (trimmed.startsWith("'") && trimmed.endsWith("'"))
                ) {
                    try {
                        text = JSON.parse(trimmed);
                    } catch (e) {
                        text = trimmed.slice(1, -1);
                    }
                }
                return text
                    .replace(/\\r\\n/g, '\n')
                    .replace(/\\n/g, '\n')
                    .replace(/\\r/g, '\n');
            };

            const normalizeConfidenceList = (list) => list.map((item) => {
                if (typeof item === 'string') {
                    const m = item.trim().match(/^(high|medium|low)\s*(.*)$/i);
                    return {
                        confidence: m ? m[1].toLowerCase() : 'unknown',
                        type: 'Unknown',
                        severity: 'Unknown',
                        location: m ? m[2].trim() : item.trim()
                    };
                }

                if (item && typeof item === 'object') {
                    return {
                        ...item,
                        confidence: item.confidence
                            ? String(item.confidence).toLowerCase()
                            : 'unknown'
                    };
                }

                return {
                    confidence: 'unknown',
                    value: String(item)
                };
            });

            const renderConfidenceList = (list) => {
                pre.textContent = '';
                list.forEach((item) => {
                    const container = document.createElement('div');
                    container.classList.add('confidence-item');

                    const conf = String(item.confidence || '').toLowerCase();
                    if (conf === 'high') container.classList.add('confidence-item-high');
                    else if (conf === 'medium') container.classList.add('confidence-item-medium');
                    else if (conf === 'low') container.classList.add('confidence-item-low');
                    else container.classList.add('confidence-item-unknown');

                    const badge = document.createElement('span');
                    badge.classList.add('confidence-badge');
                    if (conf === 'high') badge.classList.add('confidence-high');
                    else if (conf === 'medium') badge.classList.add('confidence-medium');
                    else if (conf === 'low') badge.classList.add('confidence-low');
                    else badge.classList.add('confidence-unknown');
                    badge.textContent = conf || 'unknown';

                    const details = document.createElement('div');
                    details.classList.add('confidence-details');
                    
                    const detailObj = { ...item };
                    delete detailObj.confidence;

                    const keys = Object.keys(detailObj);

                    if (keys.length === 1) {
                        const k = keys[0];
                        const v = detailObj[k];
                            details.textContent =
                            typeof v === 'string'
                                ? `${k}: ${v}`
                                : `${k}: ${JSON.stringify(v)}`;
                    } 
                    else if (keys.length > 1) {
                        details.textContent = JSON.stringify(detailObj, null, 2);
                    } else {
                        details.textContent = '';
                    }

                    container.appendChild(badge);
                    container.appendChild(details);
                    pre.appendChild(container);
                });
            };

            if (typeof results === 'string') {
                pre.textContent = decodeText(results);
                return;
            }

            if (Array.isArray(results) && specialKeys.includes(sectionKey)) {
                const normalized = normalizeConfidenceList(results);
                renderConfidenceList(normalized);
                return;
            }

            pre.textContent = JSON.stringify(results, null, 2);
        }

        function renderSections(parsed) {
            if (!parsed || typeof parsed !== 'object') {
                resultEmpty.textContent = 'No results to display.';
                resultEmpty.style.display = 'block';
                resultTabs.style.display = 'none';
                hideAllSections();
                return;
            }

            resultEmpty.style.display = 'none';
            resultTabs.style.display = 'flex';
            tabButtons.forEach(btn => {
                btn.classList.remove('status-true', 'status-false');
                const key = btn.dataset.section;
                const section = parsed[key];
                if (section && section.available === true) {
                    btn.classList.add('status-true');
                } else if (section && section.available === false) {
                    btn.classList.add('status-false');
                }
            });
            renderSectionData('file_info', parsed.file_info);
            renderSectionData('image_info', parsed.image_info);
            renderSectionData('link_info', parsed.link_info);
            renderSectionData('cross_ref_info', parsed.cross_ref_info);
            renderSectionData('pdf_metadata', parsed.pdf_metadata);
            renderSectionData('anonymity_check', parsed.anonymity_check);
            renderSectionData('hidden_prompt_check', parsed.hidden_prompt_check);
            renderSectionData('summary_info', parsed.summary_info);
            showSection('file_info');
        }

        function getSelectedChecks() {
            return Array.from(document.querySelectorAll('input[name="checks"]:checked'))
                .map(input => input.value);
        }

        function labelForCheck(key) {
            const labels = {
                image_quality: 'Image clarity verification',
                pdf_metadata: 'PDF Metadata',
                cross_ref: 'Image/table citation validation',
                link_anonymization: 'Link anonymization check',
                anonymity: 'Author anonymity check (LLM)',
                hidden_prompt: 'Hidden prompt identification (LLM)',
                summary: 'Check Summary (LLM)',
            };
            return labels[key] || key;
        }

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const key = btn.dataset.section;
                showSection(key);
            });
        });

        // File selection handler
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                updateFileInfoState(file);
            } else {
                resetFileInfoState();
            }
        });

        // Drag & drop handlers
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileWrapper.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Read CSS variables once
        const rootStyles = getComputedStyle(document.documentElement);
        const CSS_PRIMARY = rootStyles.getPropertyValue('--primary').trim() || '#2563eb';
        const CSS_DROP_BG = rootStyles.getPropertyValue('--drop-zone-highlight').trim() || 'rgba(77, 163, 255, 0.14)';

        ['dragenter', 'dragover'].forEach(eventName => {
            fileWrapper.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileWrapper.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            fileWrapper.classList.add('drag-active');
            fileWrapper.style.borderColor = CSS_PRIMARY;
            fileWrapper.style.backgroundColor = CSS_DROP_BG;
            if (dropHint) dropHint.textContent = DROP_HINT_RELEASE;
        }

        function unhighlight() {
            fileWrapper.classList.remove('drag-active');
            fileWrapper.style.borderColor = '';
            fileWrapper.style.backgroundColor = '';
            if (dropHint) {
                dropHint.textContent = fileInput.files.length > 0 ? DROP_HINT_READY : DROP_HINT_DEFAULT;
            }
        }

        fileWrapper.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const file = dt.files[0];

            if (file) {
                try {
                    fileInput.files = dt.files;
                } catch (err) {
                    // Some browsers restrict setting input.files directly; build a DataTransfer instead
                    const dataTransfer = new DataTransfer();
                    for (let i = 0; i < dt.files.length; i++) dataTransfer.items.add(dt.files[i]);
                    fileInput.files = dataTransfer.files;
                }
                // Trigger change handlers
                fileInput.dispatchEvent(new Event('change', { bubbles: true }));
            }
        });

        // Form submission handler
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const fd = new FormData(form);
            
            // Reset UI state
            resultEmpty.textContent = '';
            resultEmpty.style.display = 'block';
            resultTabs.style.display = 'none';
            hideAllSections();
            log.innerHTML = '';
            addLog('Starting file upload...');
            loading.classList.add('show');
            uploadBtn.disabled = true;
            
            try {
                addLog(`Uploading file: ${fileInput.files[0].name}`);
                const res = await fetch('/api/upload', { 
                    method: 'POST', 
                    body: fd 
                });
                
                if (!res.ok) {
                    let errMsg = `HTTP error! Status: ${res.status}`;
                    try {
                        const errJson = await res.json();
                        if (errJson && errJson.error) {
                            errMsg = errJson.error;
                        }
                    } catch (e) {
                        // ignore JSON parse errors
                    }
                    throw new Error(errMsg);
                }
                
                const json = await res.json();
                addLog('File uploaded and parsed successfully');
                loading.classList.remove('show');
                resultEmpty.textContent = 'File uploaded and parsed. Running checks...';
                resultEmpty.style.display = 'block';
                resultTabs.style.display = 'none';
                lastParseResult = json;
                lastUploadedFileName = fileInput.files[0].name;

                // Auto-run checks after successful parse
                if (json.full_text) {
                    addLog('Starting text-based checks...');
                    await runChecks();
                }
                
            } catch (err) {
                loading.classList.remove('show');
                resultEmpty.textContent = `Error: ${err.message}`;
                resultEmpty.style.display = 'block';
                resultTabs.style.display = 'none';
                hideAllSections();
                addLog(`Error: ${err.message}`);
            } finally {
                uploadBtn.disabled = false;
            }
        });

        // Run checks function
        async function runChecks() {
            if (!lastParseResult || !lastParseResult.full_text) {
                addLog('Error: No full_text path available');
                return;
            }

            const selectedChecks = getSelectedChecks();
            if (selectedChecks.length === 0) {
                resultEmpty.textContent = 'No checks selected. Please select at least one check.';
                resultEmpty.style.display = 'block';
                resultTabs.style.display = 'none';
                hideAllSections();
                addLog('No checks selected; skipping check run.');
                return;
            }

            try {
                const selectedLabels = selectedChecks.map(labelForCheck);
                addLog(`Selected checks: ${selectedLabels.join(', ')}`);
                const fullTextPath = lastParseResult.full_text;
                addLog(`Reading text from: ${fullTextPath}`);
                
                // Fetch the full text from the server
                const textRes = await fetch(`/get-text?path=${encodeURIComponent(fullTextPath)}`);
                let fullText = '';
                
                if (textRes.ok) {
                    fullText = await textRes.text();
                    addLog(`Text loaded: ${fullText.length} characters`);
                } else {
                    addLog('Error: Could not read text file');
                    resultEmpty.textContent = 'Error: Could not read text file. Please ensure the parse was successful.';
                    resultEmpty.style.display = 'block';
                    resultTabs.style.display = 'none';
                    hideAllSections();
                    return;
                }

                addLog('Running checks on extracted text...');
                const checkRes = await fetch('/api/check', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: fullText,
                        filename: lastUploadedFileName,
                        process_dir: lastParseResult.process_dir,
                        checks: selectedChecks
                    })
                });

                if (!checkRes.ok) {
                    let errMsg = `HTTP error! Status: ${checkRes.status}`;
                    try {
                        const errJson = await checkRes.json();
                        if (errJson && errJson.error) {
                            errMsg = errJson.error;
                        }
                    } catch (e) {
                        // ignore JSON parse errors
                    }
                    throw new Error(errMsg);
                }

                const checkJson = await checkRes.json();
                addLog('All selected checks finished.');
                
                // Render parsed sections
                renderSections(checkJson);

            } catch (err) {
                resultEmpty.textContent = `Error running checks: ${err.message}`;
                resultEmpty.style.display = 'block';
                resultTabs.style.display = 'none';
                hideAllSections();
                addLog(`Error running checks: ${err.message}`);
            }
        }
    </script>
</body>
</html>
